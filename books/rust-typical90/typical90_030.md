---
title: "030 - K Factors（★5）"
---

[030 \- K Factors（★5）](https://atcoder.jp/contests/typical90/tasks/typical90_ad)


# アルゴリズム

## 素因数列挙

「エラトステネスのふるい」のように行います。

* 「2🔍」 2がそれより小さな数の倍数になっているかを確認します。値が入っていませんので素数です。2の倍数すべてに ⚡+1 します。
* 「4🔍」 4がそれより小さな数の倍数になっているかを確認します。すでに `1` が入っていますので、何かの倍数です。何もしません。

このように繰り返します。

||1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
|初期||||||||||||||||
|2🔍||🔍||||||||||||||
|2⚡||⚡1||⚡1||⚡1||⚡1||⚡1||⚡1||⚡1||
|3🔍||1|🔍|1||1||1||1||1||1||
|3⚡||1|⚡1|1||⚡2||1|⚡1|1||⚡2||1|⚡1|
|4🔍||1|1|🔍1||2||1|1|1||2||1|1|
|5🔍||1|1|1|🔍|2||1|1|1||2||1|1|
|5⚡||1|1|1|⚡1|2||1|1|⚡2||2||1|⚡2|
|6🔍||1|1|1|1|🔍2||1|1|2||2||1|2|
|7🔍||1|1|1|1|2|🔍|1|1|2||2||1|2|
|7⚡||1|1|1|1|2|⚡1|1|1|2||2||⚡2|2|
|8🔍||1|1|1|1|2|1|🔍1|1|2||2||2|2|
|9🔍||1|1|1|1|2|1|1|🔍1|2||2||2|2|
|10🔍||1|1|1|1|2|1|1|1|🔍2||2||2|2|
|11🔍||1|1|1|1|2|1|1|1|2|🔍|2||2|2|
|11⚡||1|1|1|1|2|1|1|1|2|⚡1|2||2|2|
|12🔍||1|1|1|1|2|1|1|1|2|1|🔍2||2|2|
|13🔍||1|1|1|1|2|1|1|1|2|1|2|🔍|2|2|
|13⚡||1|1|1|1|2|1|1|1|2|1|2|⚡1|2|2|
|14🔍||1|1|1|1|2|1|1|1|2|1|2|1|🔍2|2|
|15🔍||1|1|1|1|2|1|1|1|2|1|2|1|2|🔍2|

「⚡」更新する数はだんだん減っていきますので、この方針で制限時間内に十分間に合います。

`0..=n` の範囲が有効な `n + 1` 要素の配列を更新するのは、次のように行います。

```rust
fn build_prime_factor_nums(n: usize) -> Vec<usize> {
    let mut primes = vec![0; n + 1];
    for i in 2..=n {
        if primes[i] > 0 {
            continue;
        }
        let m = n / i;
        for j in 1..=m {
            primes[i * j] += 1;
        }
    }
    primes
}
```

この配列の中の `k` 以上の要素数を調べることで、この問題の答えが得られます。

```rust
let count = primes.iter().filter(|&&x| x >= k).count();
```

# Tips

## Vec<u8> でメモリを減らす

理由がなければ `Vec<usize>` したいところです。しかしこの問題では $10^7$ 要素の配列が必要です。 `usize` = 8バイトの非負整数型ですので、このままでは 80MB 使うことになります。

この問題での `k` の最大数は 8 です。8回かけ算するところまで扱えれば良いなら、 `usize` ほどの情報量は不要です。 255 まで扱える 1バイトの非負整数型 `u8` にすると、10MB に減らすことができます。

```diff rust
-fn build_prime_factor_nums(n: usize) -> Vec<usize> {
+fn build_prime_factor_nums(n: usize) -> Vec<u8> {
```

80MB 使っても通りますので、この問題については特に気にしなくても良いです。


# 実装例

## 素因数列挙
https://github.com/hossy3/atcoder-solutions/blob/main/atcoder/typical90/src/bin/030_prime_factor.rs
