---
title: "059 - Many Graph Queriesï¼ˆâ˜…7ï¼‰"
---

[059 \- Many Graph Queriesï¼ˆâ˜…7ï¼‰](https://atcoder.jp/contests/typical90/tasks/typical90_bg)


# ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

## ä¾‹é¡Œ 1 ã‚’èª­ã‚€

ä¾‹é¡Œ1 ã‚’è€ƒãˆã¾ã™ã€‚é ‚ç‚¹ X ã‹ã‚‰é ‚ç‚¹ Y ã¸å‘ã‹ã†è¾ºãŒã‚ã‚Šã¾ã™ã€‚

|è¾º i|é ‚ç‚¹ X|é ‚ç‚¹ Y|
|---|---|---|
|1|1|3|
|2|2|4|
|3|1|4|
|4|4|6|
|5|5|6|
|6|1|5|

```mermaid
graph LR;
1((1))
2((2))
3((3))
4((4))
5((5))
6((6))
1 -- è¾º1 --> 3;
2 -- è¾º2 --> 4;
1 -- è¾º3 --> 4;
4 -- è¾º4 --> 6;
5 -- è¾º5 --> 6;
1 -- è¾º6 --> 5;
```

ã“ã®ã‚°ãƒ©ãƒ•ã«å¯¾ã—ã¦ã€é ‚ç‚¹ X ã‹ã‚‰é ‚ç‚¹ Y ã«åˆ°é”å¯èƒ½ã‹ã‚’èª¿ã¹ã¾ã™ã€‚

|é ‚ç‚¹ X|é ‚ç‚¹ Y|å¯èƒ½ï¼Ÿ|
|---|---|---|
|2|6|âœ…|
|1|5|âœ…|
|3|6|âŒ|

å°ã•ãªå•é¡Œã§ã¯ã‚°ãƒ©ãƒ•ã‚’æãã¨è¾¿ã‚Œã¾ã™ã€‚

```mermaid
graph LR;
1((1))
2((ğŸ”2))
3((3))
4((ğŸ”4))
5((5))
6((âœ…6))
1 -.-> 3;
2 --> 4;
1 -.-> 4;
4 --> 6;
5 -.-> 6;
1 -.-> 5;
```

```mermaid
graph LR;
1((ğŸ”1))
2((2))
3((ğŸ”3))
4((ğŸ”4))
5((âœ…5))
6((ğŸ”6))
1 --> 3;
2 -.-> 4;
1 --> 4;
4 --> 6;
5 --> 6;
1 --> 5;
```

```mermaid
graph LR;
1((1))
2((2))
3((ğŸ”3))
4((4))
5((5))
6((âŒ6))
1 -.-> 3;
2 -.-> 4;
1 -.-> 4;
4 -.-> 6;
5 -.-> 6;
1 -.-> 5;
```

AB ã®çµ„ãŒæœ€å¤§ 10ä¸‡å€‹ã€XY ã®çµ„ã‚‚æœ€å¤§ 10ä¸‡å€‹ã‚ã‚‹ã¨ã€ã‘ã£ã“ã†å¤§å¤‰ã§ã™ã€‚


## 1ã¤ãšã¤èª¿ã¹ã‚‹ (TLE)

é ‚ç‚¹2 ã‹ã‚‰ é ‚ç‚¹6 ã«é€²ã‚ã‚‹ã‹ã‚’ã€(X, Y) ã‚’é †ã«è¾¿ã£ã¦è€ƒãˆã¾ã™ã€‚

|X|Y|é ‚ç‚¹1|é ‚ç‚¹2|é ‚ç‚¹3|é ‚ç‚¹4|é ‚ç‚¹5|é ‚ç‚¹6|
|---|---|---|---|---|---|---|---|
||||âœ…|||||

é ‚ç‚¹ 2 ã‹ã‚‰è¾¿ã‚Œã‚‹å€™è£œã‚’ã™ã¹ã¦èª¿ã¹ã¾ã™ã€‚é ‚ç‚¹ 4 ã«è¾¿ã‚Œã¾ã™ã€‚

|X|Y|é ‚ç‚¹1|é ‚ç‚¹2|é ‚ç‚¹3|é ‚ç‚¹4|é ‚ç‚¹5|é ‚ç‚¹6|
|---|---|---|---|---|---|---|---|
||||âœ…|||||
|2|4||âœ…||âœ…|||

æ¬¡ã«ã€é ‚ç‚¹ 4 ã‹ã‚‰è¾¿ã‚Œã‚‹å€™è£œã‚’ã™ã¹ã¦èª¿ã¹ã¾ã™ã€‚é ‚ç‚¹ 6 ã«è¾¿ã‚Œã¾ã™ã€‚

|ğŸ”X|âš¡Y|é ‚ç‚¹1|é ‚ç‚¹2|é ‚ç‚¹3|é ‚ç‚¹4|é ‚ç‚¹5|é ‚ç‚¹6|
|---|---|---|---|---|---|---|---|
||||âœ…|||||
|2|4||âœ…ğŸ”||âœ…âš¡|||
|4|6||âœ…||âœ…ğŸ”||âœ…âš¡|

ã‚ˆã£ã¦ã€é ‚ç‚¹ 2 ã‹ã‚‰é ‚ç‚¹ 6 ã«ãŸã©ã‚Šç€ãã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã®ã‚ˆã†ã«ãƒ”ãƒ³ãƒã‚¤ãƒ³ãƒˆã«èª¿ã¹ã¦ã‚‚è‰¯ã„ã§ã™ã—ã€ã™ã¹ã¦ã® X, Y ã®çµ„ã‚’æ˜‡é †ã«å·¦ã‹ã‚‰é †ã«å½“ã¦ã¯ã‚ã‚‹ã‚ˆã†ã«ã—ã¦ã‚‚è‰¯ã„ã§ã™ã€‚X ã«ãŸã©ã‚Šç€ãæ–¹æ³•ãŒãªã„ãªã„ã¨ãã¯ã€Y ã«å€¤ãŒå…¥ã£ã¦ã„ã¦ã‚‚ä½•ã‚‚ã—ã¾ã›ã‚“ã€‚

|ğŸ”X|âš¡Y|é ‚ç‚¹1|é ‚ç‚¹2|é ‚ç‚¹3|é ‚ç‚¹4|é ‚ç‚¹5|é ‚ç‚¹6|
|---|---|---|---|---|---|---|---|
||||âœ…|||||
|1|3|ğŸ”|âœ…|||||
|1|4|ğŸ”|âœ…|||||
|1|5|ğŸ”|âœ…|||||
|2|4||âœ…ğŸ”||âœ…âš¡|||
|4|6||âœ…||âœ…ğŸ”||âœ…âš¡|
|5|6||âœ…||âœ…|ğŸ”|âœ…|

ä»–2ã¤ã‚‚åŒã˜ã‚ˆã†ã«èª¿ã¹ã‚‰ã‚Œã¾ã™ã€‚

|ğŸ”X|âš¡Y|é ‚ç‚¹1|é ‚ç‚¹2|é ‚ç‚¹3|é ‚ç‚¹4|é ‚ç‚¹5|é ‚ç‚¹6|
|---|---|---|---|---|---|---|---|
|||âœ…||||||
|1|3|âœ…ğŸ”||âœ…âš¡||||
|1|4|âœ…ğŸ”||âœ…|âœ…âš¡|||
|1|5|âœ…ğŸ”||âœ…|âœ…|âœ…âš¡||
|2|4|âœ…|ğŸ”|âœ…|âœ…|âœ…||
|4|6|âœ…||âœ…|âœ…ğŸ”|âœ…|âœ…âš¡|
|5|6|âœ…||âœ…|âœ…|âœ…ğŸ”|âœ…âš¡|

|ğŸ”X|âš¡Y|é ‚ç‚¹1|é ‚ç‚¹2|é ‚ç‚¹3|é ‚ç‚¹4|é ‚ç‚¹5|é ‚ç‚¹6|
|---|---|---|---|---|---|---|---|
|||||âœ…||||
|1|3|ğŸ”||âœ…âš¡||||
|1|4|ğŸ”||âœ…|âš¡|||
|1|5|ğŸ”||âœ…||âš¡||
|2|4||ğŸ”|âœ…||||
|4|6|||âœ…|ğŸ”||âš¡|
|5|6|||âœ…||ğŸ”|âš¡|

ã‚³ãƒ¼ãƒ‰ã¯æ¬¡ã®é€šã‚Šã§ã™ã€‚

```rust
fn f(n: usize, xy: &[(usize, usize)], (a, b): (usize, usize)) -> bool {
    let mut v = vec![false; n];
    v[a] = true;
    for &(x, y) in xy {
        v[y] |= v[x];
    }
    v[b]
}
```

ã“ã®æ–¹æ³•ã§ã ã„ãŸã„é–“ã«åˆã„ã¾ã™ã€‚ã—ã‹ã—æ®‹å¿µãªãŒã‚‰ã€é‡ã„ã‚±ãƒ¼ã‚¹ã§ã¯æ™‚é–“åˆ‡ã‚Œã«ãªã‚Šã¾ã™ã€‚

## 64ä¸¦åˆ—ã§èª¿ã¹ã‚‹

æ™‚é–“åˆ‡ã‚Œã«ãªã‚‰ãªã„ã‚ˆã†ã«ã€3å›ã®å‡¦ç†ã‚’1å›ã«ã¾ã¨ã‚ã‚‹ã“ã¨ã¯ã§ãã‚‹ã§ã—ã‚‡ã†ã‹ã€‚


ã“ã®ã‚°ãƒ©ãƒ•ã«å¯¾ã—ã¦ã€é ‚ç‚¹ X ã‹ã‚‰é ‚ç‚¹ Y ã«åˆ°é”å¯èƒ½ã‹ã‚’èª¿ã¹ã¾ã™ã€‚

|å•é¡Œç•ªå·|é ‚ç‚¹ X|é ‚ç‚¹ Y|å¯èƒ½ï¼Ÿ|
|---|---|---|---|
|0|2|6|âœ…|
|1|1|5|âœ…|
|2|3|6|âŒ|

* å•é¡Œç•ªå· 0 ã®é ‚ç‚¹ X (2) ã«ã€åˆæœŸå€¤ $2^0$ ã‚’è¶³ã—ã¾ã™
* å•é¡Œç•ªå· 1 ã®é ‚ç‚¹ X (1) ã«ã€åˆæœŸå€¤ $2^1$ ã‚’è¶³ã—ã¾ã™
* å•é¡Œç•ªå· 2 ã®é ‚ç‚¹ X (3) ã«ã€åˆæœŸå€¤ $2^2$ ã‚’è¶³ã—ã¾ã™

3ã¤ã®å•é¡Œã‚’2é€²æ•°ã§è¦‹ã‚‹ã¨ã€ãã‚Œãã‚Œã®ãƒ“ãƒƒãƒˆãŒç‹¬ç«‹ã—ã¦ã„ã¾ã™ã€‚å…ˆã»ã©ã¨åŒã˜ã‚ˆã†ã« bit or ã‚’å–ã‚Šç¶šã‘ã‚‹ã“ã¨ã§ã€çŠ¶æ…‹ã‚’ã¾ã¨ã‚ã¦èª¿ã¹ã‚‰ã‚Œã¾ã™ã€‚

|ğŸ”X|âš¡Y|é ‚ç‚¹1|é ‚ç‚¹2|é ‚ç‚¹3|é ‚ç‚¹4|é ‚ç‚¹5|é ‚ç‚¹6|
|---|---|---|---|---|---|---|---|
|||010|001|100|000|000|000|
|1|3|010ğŸ”|001|110âš¡|000|000|000|
|1|4|010ğŸ”|001|110|010âš¡|000|000|
|1|5|010ğŸ”|001|110|010|010âš¡|000|
|2|4|010|001ğŸ”|110|011âš¡|010|000|
|4|6|010|001|110|011ğŸ”|010|011âš¡|
|5|6|010|001|110|011|010ğŸ”|011âš¡|

æœ€å¾Œã«æ¬¡ã®ã‚ˆã†ã«èª¿ã¹ã¦ã€ç­”ãˆã‚’ç¢ºèªã—ã¾ã™ã€‚

* å•é¡Œç•ªå· 0 ã®é ‚ç‚¹ Y (6) ã«ã€$2^0$ ã®ãƒ“ãƒƒãƒˆãŒç«‹ã£ã¦ã„ã‚‹ã‹: yes âœ…
* å•é¡Œç•ªå· 1 ã®é ‚ç‚¹ Y (5) ã«ã€$2^1$ ã®ãƒ“ãƒƒãƒˆãŒç«‹ã£ã¦ã„ã‚‹ã‹: yes âœ…
* å•é¡Œç•ªå· 2 ã®é ‚ç‚¹ Y (6) ã«ã€$2^2$ ã®ãƒ“ãƒƒãƒˆãŒç«‹ã£ã¦ã„ã‚‹ã‹: no âŒ

ã“ã®ã‚ˆã†ã«ã—ã¦ã€`usize` (64bit OS ã§ã¯ 64bit éè² æ•´æ•°å‹) ã‚’ä½¿ã£ã¦ã¾ã¨ã‚ã¦æœ€å¤§ 64 å€‹ã®å•ã„åˆã‚ã›ã«å¯¾å¿œã§ãã¾ã™ã€‚

```rust
fn f(n: usize, xy: &[(usize, usize)], ab: &[(usize, usize)]) -> Vec<bool> {
    let mut v = vec![0usize; n];
    for (k, &(a, _)) in ab.iter().enumerate() {
        v[a] |= 1 << k;
    }
    for &(x, y) in xy {
        v[y] |= v[x];
    }

    let result: Vec<bool> = ab
        .iter()
        .enumerate()
        .map(|(k, &(_, b))| (v[b] >> k) & 1 == 1)
        .collect();
    result
}
```

å…ƒã®å•é¡Œã‚’ 64 å€‹å˜ä½ã§åˆ‡ã‚Šå‡ºã™ã«ã¯ã€ãŸã¨ãˆã° `step_by()` ã—ã¾ã™ã€‚

```rust
fn main() {
    input! {
        n: usize,
        m: usize,
        q: usize,
        mut xy: [(Usize1, Usize1); m],
        ab: [(Usize1, Usize1); q],
    }
    xy.sort();

    for i in (0..q).step_by(64) {
        let nbits = (q - i).min(64);
        let results = f(n, &xy, &ab[i..(i + nbits)]);
        for yes in results {
            println!("{}", if yes { "Yes" } else { "No" });
        }
    }
}
```


# å®Ÿè£…ä¾‹

## 1ã¤ãšã¤èª¿ã¹ã‚‹ (TLE)
https://github.com/hossy3/atcoder-solutions/blob/main/atcoder/typical90/src/bin/059_per_query_tle.rs

## 64ä¸¦åˆ—ã§èª¿ã¹ã‚‹
https://github.com/hossy3/atcoder-solutions/blob/main/atcoder/typical90/src/bin/059_per_64_queries.rs
