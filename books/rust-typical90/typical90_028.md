---
title: "028 - Cluttered Paper（★4）"
---

[028 \- Cluttered Paper（★4）](https://atcoder.jp/contests/typical90/tasks/typical90_ab)


# アルゴリズム

## 二次元いもす法

* [いもす法 \- いもす研 \(imos laboratory\)](https://imoz.jp/algorithms/imos_method.html)


(1, 1)-(3, 3) と (2, 1)-(5, 3) の 2枚の長方形を重ねることを考えます。

||1|2|3|4|5|
|---|---|---|---|---|---|
|1|🟦 +1|🟦 +1|||
|2|🟦 +1|🟦 +1|||
|3|||||

||1|2|3|4|5|
|---|---|---|---|---|---|
|1||🔴 +1|🔴 +1|🔴 +1||
|2||🔴 +1|🔴 +1|🔴 +1||
|3||||||

を重ね合わせると

||1|2|3|4|5|
|---|---|---|---|---|---|
|1|🟦 (1枚)|🟦🔴 (2枚)|🔴 (1枚)|🔴 (1枚)||
|2|🟦 (1枚)|🟦🔴 (2枚)|🔴 (1枚)|🔴 (1枚)||
|3||||||


となります。
範囲が 4×2 なら、すべての範囲内に対して +1 するのは簡単です。しかし最大 1000×1000 の範囲に $10^5$ 枚の紙を置こうとすると時間切れになります。

代わりに、階差情報だけを覚えるようにします。紙を 1つ追加するたびに、4隅に対応する 4つのマスにだけ値を入れます。左上と右下が +1, 右上と左下が -1 です。

||1|2|3|4|5|
|---|---|---|---|---|---|
|1|🟦 +1|🟦|-1||
|2|🟦|🟦|||
|3|-1|| +1||

||1|2|3|4|5|
|---|---|---|---|---|---|
|1||🔴 +1|🔴|🔴|-1|
|2||🔴|🔴|🔴||
|3||-1||| +1|

階差情報だけを足し合わせるのは簡単です。

||1|2|3|4|5|
|---|---|---|---|---|---|
|1|+1|+1|-1||-1|
|2||||||
|3|-1|-1|+1||+1|

最後に累積和を 2回とります。まず左から右です。

|→|1|2|3|4|5|
|---|---|---|---|---|---|
|1|1|2|1|1|0|
|2|0|0|0|0|0|
|3|-1|-2|-1|-1|0|

次に上から下。

|↓|1|2|3|4|5|
|---|---|---|---|---|---|
|1|1|2|1|1|0|
|2|1|2|1|1|0|
|3|0|0|0|0|0|

この枚数は、長方形内のすべてのマスに +1 していたときと同じです。

||1|2|3|4|5|
|---|---|---|---|---|---|
|1|🟦 (1枚)|🟦🔴 (2枚)|🔴 (1枚)|🔴 (1枚)||
|2|🟦 (1枚)|🟦🔴 (2枚)|🔴 (1枚)|🔴 (1枚)||
|3||||||

階差を使うと、解いている途中には負の値が現れます。非負整数型と整数型を区別する言語ではひと手間かかります。

# 実装例

## 二次元いもす法
https://github.com/hossy3/atcoder-solutions/blob/main/atcoder/typical90/src/bin/028_imos_2d.rs
