---
title: "046 - I Love 46（★3）"
---

[046 \- I Love 46（★3）](https://atcoder.jp/contests/typical90/tasks/typical90_at)


# アルゴリズム

## 同じ余りをまとめて考える

最大 $10^5$ 個の配列に対し、 $A_0+B_0+C_0$ が 46の倍数か、$A_0+B_0+C_1$ が 46の倍数か…… のように調べていくと、最大 $(10^5)^3$ 通り調べることになります。これでは間に合いません。

そこで、46 で割った余りを先に計算します。たとえば

* A = (10, 13, 470)
* B = (5, 27, 46)
* C = (55, 28, 52)

の余りは、

* A' = (10, 13, 10)
* B' = (5, 27, 0)
* C' = (9, 28, 6)

です。

それぞれ 46で割った余りが何個あるかを数えます。46要素の配列で表せます。

|余り|0..|10|..|13|..45|
|---|---|---|---|---|---|
|A||2||1||

|余り|0|..|5|..|27|..45|
|---|---|---|---|---|---|---|
|B|1||1||1||

|余り|0..|6|..|9|..|28|..45|
|---|---|---|---|---|---|---|---|
|C||1||1||1||

組み合わせた余りが 0 になるものが、46の倍数です。

## 3重ループで解く

次のように 46で割り切れる組み合わせを数え上げます。

* A の余り 10 と、B の余り 27 と、C の余り 9 を足すと 余り (10 + 27 + 9) % 46 = 0 になる
* この組み合わせは、 2通り * 1通り * 1通り = 2通り

A, B, C 3つの組み合わせを、3重ループで全探索します。 $46^3$ 通りです。一瞬で計算できます。

```rust
let mut count = 0usize;
for (i, &a0) in a.iter().enumerate() {
    for (j, &b0) in b.iter().enumerate() {
        for (k, &c0) in c.iter().enumerate() {
            if (i + j + k) % 46 == 0 {
                count += a0 * b0 * c0;
            }
        }
    }
}
```

## 2重ループで解く

先に A, B の組み合わせを計算し、その次に C と組み合わせるという方法もあります。ループを 1つ減らせます。

|余り|0..|10|..|13|..|15|..|18|..|37|..|40|..45|
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
|A + B||2||1||2||1||2||1||

|余り|0..|6|..|9|..|28|..45|
|---|---|---|---|---|---|---|---|
|C||1||1||1||

* A + B の余り 37 と、C の余り 9 を足すと 余り (37 + 9) % 46 = 0 になる
* この組み合わせは、 2通り * 1通り = 2通り

しかし $46^3$ 通りが $46^2 + 46^2$ 通りになったとしても嬉しくありません。もともと一瞬です。

```rust
let mut ab = vec![0usize; 46];
for (i, &a0) in a.iter().enumerate() {
    for (j, &b0) in b.iter().enumerate() {
        let k = (i + j) % 46;
        ab[k] += a0 * b0;
    }
}
let mut count = 0usize;
for (i, &ab0) in ab.iter().enumerate() {
    for (j, &c0) in c.iter().enumerate() {
        if (i + j) % 46 == 0 {
            count += ab0 * c0;
        }
    }
}
```

# 実装例

## 3重ループ
https://github.com/hossy3/atcoder-solutions/blob/main/atcoder/typical90/src/bin/046_3_loops.rs

## 2重ループ
https://github.com/hossy3/atcoder-solutions/blob/main/atcoder/typical90/src/bin/046_2_loops_2.rs
