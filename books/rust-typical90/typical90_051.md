---
title: "051 - Typical Shop（★5）"
---

[051 \- Typical Shop（★5）](https://atcoder.jp/contests/typical90/tasks/typical90_ay)


# アルゴリズム

## 組み合わせを全探索

(3, 8, 7, 5, 11) のうち 2つを選び、合計が 12 以下になるものが何通りかをを考えます。

|1つめ|2つめ|合計|12以下|
|---|---|---|---|
|3|8|11|✅|
|3|7|10|✅|
|3|5|8|✅|
|3|11|14||
|8|7|15||
|8|5|13||
|8|11|19||
|7|5|12|✅|
|7|11|18||
|5|11|16||

4通りです。

5個から2つを選ぶ組み合わせは $_5C_2=10$ 通りです。全探索で簡単に求められます。

しかしこの問題の制約では、40個の数列を扱います。40個中 20個を選ぶ組み合わせとすると、 $_{40}C_{20}=TODO$ になります。全探索するには大きすぎます。

## 半分全列挙

(3, 8, 7, 5, 11) を一度に扱うと大きいです。そこで半分に分け、 (3, 8) と (7, 5, 11) の組についてそれぞれ考ます。あとからまとめます。

### 左半分の表を作る

(3, 8) から 2つ以下の組み合わせを考えます。次の表になります。

|使用数(左)|パターン1|パターン2|
|---|---|---|
|0|0||
|1|3|8|
|2|3+8=11||

### 右半分の表を作る

(7, 5, 11) から 2つ以下の組み合わせを考えます。次の表になります。

|使用数(右)|パターン1|パターン2|パターン3|
|---|---|---|---|
|0|0|||
|1|7|5|11|
|2|7+5=12|7+11=18|5+11=16|

並び替えます。

|使用数(右)|パターン1|パターン2|パターン3|
|---|---|---|---|
|0|0|||
|1|5|7|11|
|2|12|16|18|

### 組み合わせる

左半分の表と右半分の表を組み合わせます。

まず左半分が 0個使用のとき、右半分から 2個使います。右半分を 2個使うパターンのうち、12個以下のものを選びます。これは二分探索 binary_search で行えます。

|左半分 0個の和|右半分 2個の和|パターン1|パターン2|パターン3|
|---|---|---|---|---|
|0|12以下|✅12|❌16|❌18|

つぎに左半分が 1個使用のときを考えます。

|左半分 1個の和|右半分 1個の和|パターン1|パターン2|パターン3|
|---|---|---|---|---|
|3|9以下|✅5|✅7|❌11|
|8|4以下|❌5|❌7|❌11|

|左半分 2個の和|右半分 0個の和|パターン1|
|---|---|---|
|12|0以下|✅0|

この ✅ の数を数え上げれば答えになります。

40個の配列の問題だとしても、半分にすれば $_{20}C_{10}$ の組み合わせになります。十分扱える大きさになります。


### 半分の表をビット全探索で作るコード例

$_3C_0$, $_3C_1$, $_3C_2$ をそれぞれ順に調べていく方法もありますが、ビット全探索でまとめて作るのが楽です。

`a = [7, 5, 11]`

|i|11|5|7|使用数|合計|コード|
|---|---|---|---|---|---|---|
|000||||0|0|`v[0].push(0)`|
|001|||7|1|7|`v[1].push(7)`|
|010||5||1|5|`v[1].push(5)`|
|011||5|7|2|12|`v[2].push(12)`|
|100|11|||1|11|`v[1].push(11)`|
|101|11||7|2|18|`v[2].push(18)`|
|110|11|5||2|16|`v[2].push(16)`|
|111|11|5|7|3|-||


```rust
fn f(k: usize, a: &[usize]) -> Vec<Vec<usize>> {
    let n = a.len();
    let mut v = vec![vec![0; 0]; k + 1];
    for i in 0..((1 << n) as usize) {
        let m = i.count_ones() as usize;
        if m > k {
            continue;
        }
        let x = (0..n).filter(|&j| i.bit_test(j)).map(|j| a[j]).sum();
        v[m].push(x);
    }
    for i in 1..=k {
        v[i].sort();
    }
    v
}
```

### 2つの表を組み合わせるコード例

```rust
let mut count = 0;
for i in 0..=k {
    for &x in &v1[i] {
        let j = v0[k - i].partition_point(|&y| x + y <= p);
        count += j;
    }
}
```

# 実装例

## 半分全列挙
https://github.com/hossy3/atcoder-solutions/blob/main/atcoder/typical90/src/bin/051_meet_in_the_middle.rs
