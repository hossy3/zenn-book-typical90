---
title: "055 - Select 5ï¼ˆâ˜…2ï¼‰"
---

[055 \- Select 5ï¼ˆâ˜…2ï¼‰](https://atcoder.jp/contests/typical90/tasks/typical90_bc)


# ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

## å…¨æ¢ç´¢

æ•°åˆ—ã‹ã‚‰ 5ã¤ã®æ•°ã‚’å–ã‚Šå‡ºã—ã¦ã‹ã‘ç®—ã—ãŸã¨ãã«ã€`(v[0] * v[1] * v[2] * v[3] * v[4]) % p == q` ã¨ãªã‚‹çµ„ã¿åˆã‚ã›ãŒã„ãã¤ã‚ã‚‹ã‹ã€ã¨ã„ã†å•é¡Œã§ã™ã€‚

å€‹æ•° N ã®åˆ¶ç´„ã¯ $N\le100$ ã§ã™ã€‚æœ€å¤§ã§ã€100å€‹ã®æ•°å­—ã‹ã‚‰ 5å€‹ã‚’é¸ã¶ã™ã¹ã¦ã®çµ„ã¿åˆã‚ã›ãŒã‚ã‚Šã¾ã™ã€‚

$$ _{100}C_5 = \frac{100 \times 99 \times 98 \times 97 \times 96}{5 \times 4 \times 3 \times 2 \times 1} = 75,287,520 $$

1000ä¸‡é€šã‚Šä»¥å†…ã§ã™ã€‚å…¨é€šã‚Šèª¿ã¹ã¦ã‚‚æ™‚é–“å†…ã«é–“ã«åˆã„ã¾ã™ã€‚

```rust
fn main() {
    input! {
        n: usize,
        p: usize,
        q: usize,
        a: [usize; n]
    }
    // count ã‚’è¨ˆç®—
    println!("{count}");
}
```

count ã‚’è¨ˆç®—ã™ã‚‹æ–¹æ³•ã¯å¤šæ•°ã‚ã‚Šã¾ã™ã€‚

## 5é‡ãƒ«ãƒ¼ãƒ—

8å€‹ã‹ã‚‰ 5å€‹é¸ã¶ã¨ã—ã¾ã™ã€å·¦ã‹ã‚‰é †ã« ğŸ‘ ã‚’é¸ã³ã€æ¬¡ã®å€™è£œã¯ãã®å³ã‹ã‚‰é¸ã³ã¾ã™ã€‚

æœ€åˆã® 1ã¤ã‚’é¸ã¶å€™è£œ ğŸ” ã¯ 8 - (5 - 1) = 4 å€‹ã«ãªã‚Šã¾ã™ã€‚ä¸€ç•ªå³ç«¯ã‚’é¸ã‚“ã ã¨ã—ã¦ã‚‚ã€ãã®å³ã‹ã‚‰æ®‹ã‚Š 4ã¤ã‚’é¸ã¹ã‚‹ã‚ˆã†ã«ã€ã§ã™ã€‚

é…åˆ— [0, 1, 2, 3, 4, 5, 6, 7] ã‹ã‚‰ (1, 2, 5, 6, 7) ç•ªç›®ã‚’é¸ã³ã€10 ã§å‰²ã£ãŸä½™ã‚ŠãŒ 0 ã«ãªã‚‹ã‚‚ã®ã‚’æ¢ã™ã¨ã—ã¾ã™ã€‚æ¬¡ã®è¡¨ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

||0|1|2|3|4|5|6|7|x|
|---|---|---|---|---|---|---|---|---|---|
||ğŸ”|ğŸ”|ğŸ”|ğŸ”|âŒ|âŒ|âŒ|âŒ|
|i0 = 1||ğŸ‘|||||||1 % 10 = 1|
||||ğŸ”|ğŸ”|ğŸ”|âŒ|âŒ|âŒ|
|i1 = 2|||ğŸ‘||||||(1 * 2) % 10 = 2|
|||||ğŸ”|ğŸ”|ğŸ”|âŒ|âŒ|
|i2 = 5||||||ğŸ‘|||(2 * 5) % 10 = 0|
||||||||ğŸ”|âŒ|
|i3 = 6|||||||ğŸ‘||(0 * 6) % 10 = 0|
|||||||||ğŸ”|
|i4 = 7||||||||ğŸ‘|(0 * 7) % 10 = 0|

(1 * 2 * 5 * 6 * 7) ã‚’ 10ã§å‰²ã£ãŸä½™ã‚Šã¨ã€1ã¤ã‹ã‘ç®—ã™ã‚‹ãŸã³ã« 10ã§å‰²ã£ãŸä½™ã‚Šã¯åŒã˜ã§ã™ã€‚å¤§ããªæ•°ã®ã‹ã‘ç®—ã‚’ç¹°ã‚Šè¿”ã™ã¨ `u64` å‹ãªã©ã®ç¯„å›²ã«ãŠã•ã¾ã‚‰ãšãšã«ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã—ã¾ã™ã€‚ãã“ã§æ¯å›ä½™ã‚Šã‚’å–ã‚Šã¾ã™ã€‚

ã‚³ãƒ¼ãƒ‰ã§ã™:

```rust
let mut count = 0usize;
for i0 in 0..(n - 4) {
    for i1 in (i0 + 1)..(n - 3) {
        let x = (a[i0] * a[i1]) % p;
        for i2 in (i1 + 1)..(n - 2) {
            let x = (x * a[i2]) % p;
            for i3 in (i2 + 1)..(n - 1) {
                let x = (x * a[i3]) % p;
                for i4 in (i3 + 1)..n {
                    let x = (x * a[i4]) % p;
                    if x == q {
                        count += 1;
                    }
                }
            }
        }
    }
}
```

ã“ã‚Œã§ AC ã§ãã¾ã™ã€‚


## å†å¸°

5é‡ãƒ«ãƒ¼ãƒ—ã ã¨ä¼¼ãŸã‚³ãƒ¼ãƒ‰ã®ç¹°ã‚Šè¿”ã—ãŒç¾ã‚Œã¾ã™ã€‚å†å¸°ã§ã‚‚è§£ã‘ã¾ã™ã€‚

|rest|x|&a|0|1|2|3|4|5|6|7|æ¬¡ã® x|
|---|---|---|---|---|---|---|---|---|---|---|---|
|4|1|[0, 1, 2, 3, 4, 5, 6, 7]|ğŸ”|ğŸ”|ğŸ”|ğŸ”|âŒ|âŒ|âŒ|âŒ|
|||||ğŸ‘|||||||1 % 10 = 1|
|3|1|[2, 3, 4, 5, 6, 7]|||ğŸ”|ğŸ”|ğŸ”|âŒ|âŒ|âŒ|
||||||ğŸ‘||||||(1 * 2) % 10 = 2|
|2|2|[3, 4, 5, 6, 7]||||ğŸ”|ğŸ”|ğŸ”|âŒ|âŒ|
|||||||||ğŸ‘|||(2 * 5) % 10 = 0|
|1|0|[6, 7]|||||||ğŸ”|âŒ|
||||||||||ğŸ‘||(0 * 6) % 10 = 0|
|0|0|[7]||||||||ğŸ”|
|||||||||||ğŸ‘|(0 * 7) % 10 = 0|


ã‚³ãƒ¼ãƒ‰ã§ã™:

```rust
fn f(cur: usize, rest: usize, p: usize, q: usize, a: &[usize]) -> usize {
    if rest == 0 {
        a.iter().filter(|&&x| (cur * x) % p == q).count()
    } else {
        let mut count = 0;
        for (i, &x) in a[..(a.len() - rest)].iter().enumerate() {
            count += f((cur * x) % p, rest - 1, p, q, &a[(i + 1)..]);
        }
        count
    }
}
```

```rust
let cur = 1;
let rest = 4;
let count = f(cur, rest, p, q, &a);
```

ç¹°ã‚Šè¿”ã—ã¯æ¸›ã‚Šã¾ã—ãŸã€‚ãƒ«ãƒ¼ãƒ—ã®æ–¹ãŒæ¥½ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚


## çµ„ã¿åˆã‚ã›

* [Itertools in itertools \- Rust > combinations()](https://docs.rs/itertools/latest/itertools/trait.Itertools.html#method.combinations)
* [Itertools in itertools \- Rust > tuple_combinations()](https://docs.rs/itertools/latest/itertools/trait.Itertools.html#method.tuple_combinations)

Itertools ã®çµ„ã¿åˆã‚ã›é–¢æ•°ã‚’ä½¿ã†ã¨ã€5é‡ãƒ«ãƒ¼ãƒ—ã‚‚å†å¸°ã‚‚ãªãç°¡å˜ã«æ›¸ã‘ã¾ã™ã€‚

```rust
let count = a
    .iter()
    .combinations(5)
    .filter(|v| v.iter().fold(1, |acc, &&x| (acc * x) % p) == q)
    .count();
```

```rust
let count = a
    .iter()
    .tuple_combinations()
    .filter(|x: &(&_, &_, &_, &_, &_)| {
        (((((((x.0 * x.1) % p) * x.2) % p) * x.3) % p) * x.4) % p == q
    })
    .count();
```

ã—ã‹ã—ãƒ«ãƒ¼ãƒ—ã‚„å†å¸°ã«æ¯”ã¹ã‚‹ã¨ä¸€æ¡é…ã„ã§ã™ã€‚ TLE ã—ãªã„ã‚‚ã®ã®åˆ¶é™æ™‚é–“ãŒå±ãªã„æ„Ÿã˜ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚[^1] ã©ã¡ã‚‰ã®æ–¹æ³•ã§ã‚‚é€Ÿåº¦ã¯å¤‰ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚

[^1]: çµ„ã¿åˆã‚ã›ãŒæ±‚ã¾ã£ã¦ã‹ã‚‰ã¾ã¨ã‚ã¦è¨ˆç®—ã™ã‚‹ã¨ã€åŒã˜è¨ˆç®—ã®ç¹°ã‚Šè¿”ã—ãŒç¾ã‚Œã‚‹ã“ã¨ãŒç†ç”±ã ã¨æ€ã„ã¾ã™ã€‚çµ„ã¿åˆã‚ã›ã‚’ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ãƒ¼ã§å–ã‚Šå‡ºã›ã‚‹ `Vec` ã«çµ„ã¿ç«‹ã¦ã‚‹ã¨ã“ã‚ã§ã‚‚è¿½åŠ ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚Šãã†ã§ã™ã€‚


# å®Ÿè£…ä¾‹

æå‡ºã—ãŸã¨ãã®å®Ÿè¡Œæ™‚é–“:
||å®Ÿè¡Œæ™‚é–“|
|---|---|
|5é‡ãƒ«ãƒ¼ãƒ—|257 ms|
|5é‡ãƒ«ãƒ¼ãƒ— (ä½é€Ÿ)|917 ms|
|å†å¸°|245 ms|
|combinations|2367 ms|
|tuple_combinations|2696 ms|

## 5é‡ãƒ«ãƒ¼ãƒ—
https://github.com/hossy3/atcoder-solutions/blob/main/atcoder/typical90/src/bin/055_5_loops.rs

## 5é‡ãƒ«ãƒ¼ãƒ— (ä½é€Ÿ)
https://github.com/hossy3/atcoder-solutions/blob/main/atcoder/typical90/src/bin/055_5_loops_slow.rs

## å†å¸°
https://github.com/hossy3/atcoder-solutions/blob/main/atcoder/typical90/src/bin/055_recursive.rs

## combinations
https://github.com/hossy3/atcoder-solutions/blob/main/atcoder/typical90/src/bin/055_combinations.rs

## tuple_combinations
https://github.com/hossy3/atcoder-solutions/blob/main/atcoder/typical90/src/bin/055_tuple_combinations.rs
