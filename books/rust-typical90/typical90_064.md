---
title: "064 - Upliftï¼ˆâ˜…3ï¼‰"
---

[064 \- Upliftï¼ˆâ˜…3ï¼‰](https://atcoder.jp/contests/typical90/tasks/typical90_bl)


# ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

## åœ°æ®»å¤‰å‹•ã‚’å›³ç¤º

ä¾‹é¡Œ2 ã®æœ€åˆã®æ‰‹é †ã‚’å›³ç¤ºã—ã¾ã™ã€‚

```mermaid
xychart-beta
  title "åœ°æ®»å¤‰å‹•å‰"
  x-axis [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
  y-axis "æ¨™é«˜" -120 --> 180
  bar [-150]
  bar [61, 51, 92, -100, -89, -65, -89, -64, -74, 7, 87, -2, 51, -39, -50, 63, -23, 36, 74, 37]
```

```mermaid
xychart-beta
  title "åœ°æ®»å¤‰å‹• 1å›ç›®: åŒºç”» [2..2] ã‚’ -45 ã™ã‚‹"
  x-axis [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
  y-axis "æ¨™é«˜" -120 --> 180
  bar [-150, 51]
  bar [61, 6, 92, -100, -89, -65, -89, -64, -74, 7, 87, -2, 51, -39, -50, 63, -23, 36, 74, 37]
```

```mermaid
xychart-beta
  title "åœ°æ®»å¤‰å‹• 2å›ç›®: åŒºç”» [6..19] ã‚’ +89 ã™ã‚‹"
  x-axis [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
  y-axis "æ¨™é«˜" -120 --> 180
  bar [-150]
  bar [61, 6, 92, -100, -89, 17, -7, 18, 8, 89, 169, 80, 133, 43, 32, 145, 59, 118, 156, 37]
  bar [-150, -150, -150, -150, -150, -31, -31, -31, -31, -31, -31, -31, -31, -31, -31, -31, -31, -31, -31]
```

```mermaid
xychart-beta
  title "åœ°æ®»å¤‰å‹• 3å›ç›®: åŒºç”» [2..9] ã‚’ +36 ã™ã‚‹"
  x-axis [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
  y-axis "æ¨™é«˜" -120 --> 180
  bar [-150]
  bar [61, 42, 128, -64, -53, 53, 29, 54, 44, 89, 169, 80, 133, 43, 32, 145, 59, 118, 156, 37]
  bar [-150, -84, -84, -84, -84, -84, -84, -84, -84]
```

## ä¸ä¾¿ã•ã®å®šç¾©

ä¸ä¾¿ã• ğ‘† ã¯ã€éš£æ¥ã™ã‚‹æ¨™é«˜ã®å·®ã®çµ¶å¯¾å€¤ã®ç·å’Œã§ã™ã€‚

$$
S = \sum_{i=1}^{N-1} |E_{i+1} - E_i|
$$

æœ€åˆã®ä¸ä¾¿ã•ã‚’æ±‚ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

```rust
let mut diffs: Vec<_> = (0..(n - 1)).map(|i| a[i + 1] - a[i]).collect();
let mut score: i64 = diffs.iter().map(|x| x.abs()).sum();
```

æ¨™é«˜ã‚’å¤‰æ›´ã™ã‚‹ãŸã³ã«ã€ä¸ä¾¿ã•ã‚’å†è¨ˆç®—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã—ã‹ã—è¨ˆç®—ã‚’ç´ æœ´ã«è¡Œã†ã¨ã€å„ã‚¯ã‚¨ãƒªã§ $ğ‘‚(ğ‘)$ ã®å‡¦ç†ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚ã‚¯ã‚¨ãƒªãŒ $Q$ å€‹ã‚ã‚‹ã¨ã€æœ€æ‚ª
$ğ‘‚(ğ‘Q)$ ã®è¨ˆç®—æ™‚é–“ã¨ãªã‚Šã€TLE ã—ã¾ã™ã€‚


## éšå·®ã‚’ç”¨ã„ãŸåŠ¹ç‡åŒ–

æ¨™é«˜å·® $ğ¸_{i+1}-E_i$ ã‚’ç®¡ç†ã™ã‚Œã°ã€åŒºé–“å¤‰æ›´ã®å½±éŸ¿ã‚’ $ğ‘‚(1)$ ã§è¨ˆç®—ã§ãã¾ã™ã€‚

ãŸã¨ãˆã°ã€åŒºç”» `[2..9]` ã‚’ +36 ã™ã‚‹ã¨ãã€æ¬¡ã®2ã¤ã®æ¨™é«˜å·®ã ã‘ã«å½±éŸ¿ãŒå‡ºã¾ã™ã€‚

* åŒºé–“1 ï½ åŒºé–“2 ï¼ˆå³ã ã‘å¢—åŠ ï¼‰
* åŒºé–“9 ï½ åŒºé–“10 ï¼ˆå·¦ã ã‘å¢—åŠ ï¼‰

ã—ãŸãŒã£ã¦ã€ä¸ä¾¿ã•ã‚’å‰å›ã®å€¤ã‹ã‚‰ç›´æ¥æ›´æ–°ã§ãã¾ã™ã€‚

æ¨™é«˜ $E_i$ ã®å¤‰æ›´ã‚’ãã®ã¾ã¾æ‰±ã†ã¨ã€æ¬¡ã®è¡¨ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚

||1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
|æœ€åˆ|61|51|92|-100|-89|-65|-89|-64|-74|7|87|-2|51|-39|-50|63|-23|36|74|37|
|1å›ç›®|61|âš¡6|92|-100|-89|-65|-89|-64|-74|7|87|-2|51|-39|-50|63|-23|36|74|37|
|2å›ç›®|61|6|92|-100|-89|âš¡17|âš¡-7|âš¡18|âš¡8|âš¡89|âš¡169|âš¡80|âš¡133|âš¡43|âš¡32|âš¡145|âš¡59|âš¡118|âš¡156|37|
|3å›ç›®|61|âš¡42|âš¡128|âš¡-64|âš¡-53|âš¡53|âš¡29|âš¡54|âš¡44|89|169|80|133|43|32|145|59|118|156|37|

æ¨™é«˜ã®å·® $E_{i+1}-E_i$ ã‚’æ‰±ã†ã¨ã€æ¬¡ã®è¡¨ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

||1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|ä¸ä¾¿ã•|
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
|æœ€åˆ|-10|41|-192|11|24|-24|25|-10|81|80|-89|53|-90|-11|113|-86|59|38|-37|(1074)|
|1å›ç›®|âš¡-55|âš¡86|-192|11|24|-24|25|-10|81|80|-89|53|-90|-11|113|-86|59|38|-37|(1164)|
|2å›ç›®|-55|86|-192|11|âš¡106|-24|25|-10|81|80|-89|53|-90|-11|113|-86|59|38|âš¡-119|(1328)|
|3å›ç›®|âš¡-19|86|-192|11|106|-24|25|-10|âš¡45|80|-89|53|-90|-11|113|-86|59|38|-119|(1256)|

åœ°æ®»å¤‰å‹•å¾Œã®ä¸ä¾¿ã•ã¯ã€ç›´å‰ã®ä¸ä¾¿ã•ã¨ âš¡ ã®å‰å¾Œã®å€¤ã‹ã‚‰æ±‚ã¾ã‚Šã¾ã™ã€‚

3å›ç›®ã®å¤‰æ›´ã¯ã€Œ-55 â†’ -19, 81 â†’ 45ã€ã¨å¤‰ã‚ã£ã¦ã„ã¾ã™ã€‚ä¸ä¾¿ã•ã¯ã©ã¡ã‚‰ã‚‚æ¨™é«˜å·®ãŒç¸®ã¾ã‚‹æ–¹å‘ã§ã™ã®ã§ã€(55-19) + (81-45) = 72 ã ã‘å‰å›ã‚ˆã‚Šå°ã•ããªã‚Šã¾ã™ã€‚1328 - 1256 = 72 ã§ã™ã€‚

ã“ã®è€ƒãˆæ–¹ã‚’ Rust ã§å®Ÿè£…ã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```rust
for (l, r, v) in lrv {
    if l > 0 {  // å·¦ç«¯ã§ãªã„å ´åˆ
        score -= diffs[l - 1].abs();  // å¤‰æ›´å‰ã®ä¸ä¾¿ã•ã‚’æ¸›ç®—
        diffs[l - 1] += v;  // å¤‰æ›´ã‚’é©ç”¨
        score += diffs[l - 1].abs();  // å¤‰æ›´å¾Œã®ä¸ä¾¿ã•ã‚’åŠ ç®—
    }
    if r < n - 1 {  // å³ç«¯ã§ãªã„å ´åˆ
        score -= diffs[r].abs();
        diffs[r] -= v;
        score += diffs[r].abs();
    }
    println!("{score}");
}
```

ã“ã¡ã‚‰ã§è§£ã‘ã¾ã—ãŸã€‚

## ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæœ¨ã§åˆè¨ˆã‚’æ±‚ã‚ã‚‹

éšå·®ã¨ä¸ä¾¿ã•ã®2ã‹æ‰€ã‚’æ›´æ–°ã™ã‚‹ã®ã¯å°‘ã—æ‰‹é–“ãŒã‹ã‹ã‚Šã¾ã™ã€‚

ä¸€å¿œã€ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæœ¨ã«ã‚¹ã‚³ã‚¢ã®æ›´æ–°ã‚’ãŠä»»ã›ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

```rust
let mut segtree = Segtree::<AbsAdd<_>>::from(diffs);

for (l, r, v) in lrv {
    if l > 0 {  // å·¦ç«¯ã§ãªã„å ´åˆ
        segtree.set(l - 1, segtree.get(l - 1) + v);  // å¤‰æ›´ã‚’é©ç”¨
    }
    if r < n - 1 {  // å³ç«¯ã§ãªã„å ´åˆ
        segtree.set(r, segtree.get(r) - v);
    }
    let score = segtree.all_prod();  // ä¸ä¾¿ã•ã‚’æ›´æ–°
    println!("{score}");
}
```

ä¸€å¿œã§ãã¾ã™ãŒã€ã‹ãˆã£ã¦è¤‡é›‘ã«ã‚‚æ€ã„ã¾ã™ã€‚


# å®Ÿè£…ä¾‹

## éšå·®æ•°åˆ— + å‰å›ã¨ã®å·®åˆ†
https://github.com/hossy3/atcoder-solutions/blob/main/atcoder/typical90/src/bin/064_diff.rs

## éšå·®æ•°åˆ— + ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæœ¨
https://github.com/hossy3/atcoder-solutions/blob/main/atcoder/typical90/src/bin/064_segtree.rs

